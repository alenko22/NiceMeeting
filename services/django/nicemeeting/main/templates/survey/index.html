{% extends 'survey/base.html' %}

{% block title%}
Анкета
{% endblock %}

{% block content %}
<div class="page-content">
    <div class="container" style="max-width: 600px; margin: 0 auto; padding: 20px;">
        <h2 style="text-align: center; margin-bottom: 30px;">Заполните свою анкету</h2>

        <form id="surveyForm" method="post" action="survey/rating">
            {% csrf_token %}

            <div>{{ form.non_field_errors }}</div>
            {% for f in form %}
                <p><label for="{{ f.id_for_label}}">{{f.label}}: </label>{{ f }}</p>
                <div>{{ f.errors }}</div>
            {% endfor %}

            <button class="btn btn-primary" type="submit">Отправить</button>
        </form>
    </div>
</div>

<div class="modal-overlay" id="consentModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title">Соглашение об обработке персональных данных</h3>
            <button class="close-btn" id="closeConsent">&times;</button>
        </div>
        <div class="modal-body">
            <p>Настоящим я, в соответствии с Федеральным законом от 27.07.2006 № 152-ФЗ "О персональных данных",
                свободно, своей волей и в своем интересе выражаю согласие на обработку предоставленных мной
                персональных данных в целях использования сервисов и продуктов платформы Nice Meeting.</p>

            <p>Я подтверждаю, что ознакомлен(а) с правами в области персональных данных, предусмотренными
                Федеральным законом от 27.07.2006 № 152-ФЗ "О персональных данных", в том числе на получение
                информации, касающейся обработки моих персональных данных, на их уточнение, блокирование или
                уничтожение в случае, если персональные данные являются неполными, устаревшими, неточными,
                незаконно полученными или не являются необходимыми для заявленной цели обработки.</p>

            <p>Согласие действует до момента его отзыва мной в письменной форме.</p>
        </div>
        <div class="modal-footer">
            <button class="btn btn-secondary" id="declineConsent">Отклонить</button>
            <button class="btn btn-primary" id="acceptConsent">Принять</button>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const showConsentBtn = document.getElementById('showConsent');
        const consentModal = document.getElementById('consentModal');
        const closeConsentBtn = document.getElementById('closeConsent');
        const declineConsentBtn = document.getElementById('declineConsent');
        const acceptConsentBtn = document.getElementById('acceptConsent');
        const consentCheckbox = document.getElementById('consent');
        const surveyForm = document.getElementById('surveyForm');

        showConsentBtn.addEventListener('click', function(e) {
            e.preventDefault();
            consentModal.style.display = 'flex';
        });

        closeConsentBtn.addEventListener('click', function() {
            consentModal.style.display = 'none';
        });

        declineConsentBtn.addEventListener('click', function() {
            consentModal.style.display = 'none';
            consentCheckbox.checked = false;
        });

        acceptConsentBtn.addEventListener('click', function() {
            consentModal.style.display = 'none';
            consentCheckbox.checked = true;
        });

        // Закрытие модального окна при клике вне его
        window.addEventListener('click', function(e) {
            if (e.target === consentModal) {
                consentModal.style.display = 'none';
            }
        });

        // Предотвращение отправки формы без согласия
        surveyForm.addEventListener('submit', function(e) {
            if (!consentCheckbox.checked) {
                e.preventDefault();
                alert('Пожалуйста, подтвердите согласие на обработку персональных данных');
                return false;
            }
        });
    });
</script>
{% endblock %}
