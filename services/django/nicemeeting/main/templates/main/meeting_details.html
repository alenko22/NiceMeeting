{% extends 'main/base.html' %}
{% load static %}

{% block title %}
–í—Å—Ç—Ä–µ—á–∞ ‚Äî Nice Meeting
{% endblock %}

{% block content %}
<div class="meeting-detail">
    <div class="container">
        <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
        <div class="meeting-detail__breadcrumbs">
            <a href="{% url 'meetings' %}" class="meeting-detail__breadcrumb-link">‚Üê –ú–æ–∏ –≤—Å—Ç—Ä–µ—á–∏</a>
        </div>

        <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –≤—Å—Ç—Ä–µ—á–∏ -->
        <div class="meeting-detail__card">
            <!-- –°—Ç–∞—Ç—É—Å –≤—Å—Ç—Ä–µ—á–∏ -->
            <div class="meeting-detail__status meeting-detail__status--{% if is_past %}past{% elif is_today %}today{% else %}upcoming{% endif %}">
                {% if is_past %}
                    <svg class="meeting-detail__status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span class="meeting-detail__status-text">–í—Å—Ç—Ä–µ—á–∞ –ø—Ä–æ—à–ª–∞</span>
                {% elif is_today %}
                    <svg class="meeting-detail__status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span class="meeting-detail__status-text">–°–µ–≥–æ–¥–Ω—è</span>
                {% else %}
                    <svg class="meeting-detail__status-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <circle cx="12" cy="12" r="10"></circle>
                        <polyline points="12 6 12 12 16 14"></polyline>
                    </svg>
                    <span class="meeting-detail__status-text">–í—Å—Ç—Ä–µ—á–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞</span>
                {% endif %}
            </div>

            <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
            <div class="meeting-detail__header">
                <h1 class="meeting-detail__title">
                    {% if meeting.event %}
                        –í—Å—Ç—Ä–µ—á–∞ –Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–∏
                    {% else %}
                        –í—Å—Ç—Ä–µ—á–∞
                    {% endif %}
                </h1>
                {% if time_until_meeting %}
                    <div class="meeting-detail__countdown">
                        <svg class="meeting-detail__countdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"></circle>
                            <polyline points="12 6 12 12 16 14"></polyline>
                        </svg>
                        <span class="meeting-detail__countdown-text">–î–æ –Ω–∞—á–∞–ª–∞: <strong>{{ time_until_meeting }}</strong></span>
                    </div>
                {% endif %}
            </div>

            <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å—Ç—Ä–µ—á–µ -->
            <div class="meeting-detail__info-grid">
                <!-- –î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è -->
                <div class="meeting-detail__info-item">
                    <div class="meeting-detail__info-icon-wrapper">
                        <svg class="meeting-detail__info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                            <line x1="16" y1="2" x2="16" y2="6"/>
                            <line x1="8" y1="2" x2="8" y2="6"/>
                            <line x1="3" y1="10" x2="21" y2="10"/>
                        </svg>
                    </div>
                    <div class="meeting-detail__info-content">
                        <div class="meeting-detail__info-label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</div>
                        <div class="meeting-detail__info-value">
                            {{ meeting.datetime|date:"d E Y" }} –≤ {{ meeting.datetime|time:"H:i" }}
                        </div>
                    </div>
                </div>

                <!-- –ú–µ—Å—Ç–æ –∏–ª–∏ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ -->
                {% if meeting.event %}
                <div class="meeting-detail__info-item">
                    <div class="meeting-detail__info-icon-wrapper">
                        <svg class="meeting-detail__info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                    <div class="meeting-detail__info-content">
                        <div class="meeting-detail__info-label">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</div>
                        <div class="meeting-detail__info-value">
                            <a href="{% url 'event_detail' meeting.event.id %}" class="meeting-detail__event-link">{{ meeting.event.title }}</a>
                        </div>
                        {% if meeting.event.place %}
                        <div class="meeting-detail__info-subvalue">
                            üìç {{ meeting.event.place }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% elif meeting.place %}
                <div class="meeting-detail__info-item">
                    <div class="meeting-detail__info-icon-wrapper">
                        <svg class="meeting-detail__info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                        </svg>
                    </div>
                    <div class="meeting-detail__info-content">
                        <div class="meeting-detail__info-label">–ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏</div>
                        <div class="meeting-detail__info-value">{{ meeting.place }}</div>
                    </div>
                </div>
                {% endif %}

                <!-- –£—á–∞—Å—Ç–Ω–∏–∫–∏ -->
                <div class="meeting-detail__info-item">
                    <div class="meeting-detail__info-icon-wrapper">
                        <svg class="meeting-detail__info-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                            <circle cx="9" cy="7" r="4"></circle>
                            <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                            <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                        </svg>
                    </div>
                    <div class="meeting-detail__info-content">
                        <div class="meeting-detail__info-label">–£—á–∞—Å—Ç–Ω–∏–∫–∏</div>
                        <div class="meeting-detail__participants">
                            {% for participant in all_participants %}
                            <div class="meeting-detail__participant">
                                <div class="meeting-detail__participant-avatar">
                                    {% if participant.avatar %}
                                        <img src="{{ participant.avatar.url }}" alt="{{ participant.get_full_name|default:participant.username }}" class="meeting-detail__participant-img">
                                    {% else %}
                                        <div class="meeting-detail__participant-placeholder">
                                            {{ participant.username|first|upper }}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="meeting-detail__participant-info">
                                    <div class="meeting-detail__participant-name">
                                        {{ participant.get_full_name|default:participant.username }}
                                    </div>
                                    {% if participant == request.user %}
                                        <div class="meeting-detail__participant-role">(–í—ã)</div>
                                    {% elif participant == meeting.user2 %}
                                        <div class="meeting-detail__participant-role">(–ü—Ä–∏–≥–ª–∞—à—ë–Ω–Ω—ã–π)</div>
                                    {% else %}
                                        <div class="meeting-detail__participant-role">(–û—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä)</div>
                                    {% endif %}
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–µ–π—Å—Ç–≤–∏—è -->
            {% if is_organizer or is_invited %}
            <div class="meeting-detail__actions">
                <div class="meeting-detail__actions-grid">
                    {% if is_upcoming %}
                        {% if is_organizer %}
                        <button class="btn btn-outline meeting-detail__action-btn" id="editMeetingBtn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                        </button>
                        {% endif %}
                        
                        <button class="btn btn-primary meeting-detail__action-btn" id="sendMessageBtn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
                            </svg>
                            –ù–∞–ø–∏—Å–∞—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–∞–º
                        </button>
                        
                        <button class="btn btn-outline meeting-detail__action-btn" id="addToCalendarBtn">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            –í –∫–∞–ª–µ–Ω–¥–∞—Ä—å
                        </button>
                    {% endif %}
                    
                    {% if is_organizer %}
                    <button class="btn btn-danger meeting-detail__action-btn" id="deleteMeetingBtn">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <polyline points="3 6 5 6 21 6"></polyline>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                        –û—Ç–º–µ–Ω–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É
                    </button>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <div class="modal modal--edit-meeting" id="editMeetingModal">
            <div class="modal__backdrop"></div>
            <div class="modal__dialog">
                <div class="modal__content">
                    <div class="modal__header">
                        <h3 class="modal__title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å—Ç—Ä–µ—á—É</h3>
                        <button class="modal__close-btn" id="closeEditMeetingModal">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="modal__body">
                        <form id="editMeetingForm" class="edit-meeting-form" data-meeting-id="{{ meeting.id }}">
                            {% csrf_token %}
                            <div class="form-field">
                                <label class="form-field__label">–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</label>
                                <input type="datetime-local" name="datetime" class="form-field__input edit-meeting-form__datetime-input" value="{{ meeting.datetime|date:'Y-m-d' }}T{{ meeting.datetime|time:'H:i' }}" required>
                                <span class="form-field__error edit-meeting-form__datetime-error"></span>
                            </div>
                            
                            {% if meeting.event %}
                            <div class="form-field">
                                <label class="form-field__label">–ú–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</label>
                                <select name="event" class="form-field__select edit-meeting-form__event-select">
                                    <option value="{{ meeting.event.id }}">{{ meeting.event.title }}</option>
                                </select>
                            </div>
                            {% else %}
                            <div class="form-field">
                                <label class="form-field__label">–ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏</label>
                                <input type="text" name="place" class="form-field__input edit-meeting-form__place-input" value="{{ meeting.place }}" maxlength="255">
                                <span class="form-field__error edit-meeting-form__place-error"></span>
                            </div>
                            {% endif %}
                        </form>
                    </div>
                    <div class="modal__footer">
                        <button type="button" class="btn btn-secondary" id="closeEditMeetingModalBtn">–û—Ç–º–µ–Ω–∞</button>
                        <button type="submit" form="editMeetingForm" class="btn btn-primary edit-meeting-form__submit-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
        <div class="modal modal--confirm-delete" id="deleteMeetingModal">
            <div class="modal__backdrop"></div>
            <div class="modal__dialog">
                <div class="modal__content">
                    <div class="modal__header">
                        <h3 class="modal__title">–û—Ç–º–µ–Ω–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É?</h3>
                        <button class="modal__close-btn" id="closeDeleteMeetingModal">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="modal__body">
                        <p class="modal__message">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –æ—Ç–º–µ–Ω–∏—Ç—å —ç—Ç—É –≤—Å—Ç—Ä–µ—á—É? –í—Å–µ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –ø–æ–ª—É—á–∞—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.</p>
                    </div>
                    <div class="modal__footer">
                        <button type="button" class="btn btn-secondary" id="closeDeleteMeetingModalBtn">–û—Ç–º–µ–Ω–∞</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteMeetingBtn">–û—Ç–º–µ–Ω–∏—Ç—å –≤—Å—Ç—Ä–µ—á—É</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="{% static 'js/meeting_details.js' %}"></script>
{% endblock %}