{% extends 'main/base.html' %}
{% load static %}


{% block title %}
Мероприятия
{% endblock %}

{% block content %}
<div class="page-content">
    <div class="container">
        <h1 class="events__title">Мероприятия в твоём городе</h1>
        <p class="events__subtitle">Найди интересные события и встреться с новыми людьми</p>

        <!-- Фильтры -->
        <div class="events__filters">
            <div class="events__filter-group">
                <label class="events__filter-label">Дата:</label>
                <div class="events__filter-buttons">
                    <button class="btn btn-outline events__filter-btn events__filter-btn--active">Сегодня</button>
                    <button class="btn btn-outline events__filter-btn">Завтра</button>
                    <button class="btn btn-outline events__filter-btn">На этой неделе</button>
                    <button class="btn btn-outline events__filter-btn">В этом месяце</button>
                </div>
            </div>
        </div>

        <!-- Сетка мероприятий -->
        <div class="events__grid">
            {% for event in page_obj %}
            <div class="events__item">
                <div class="events__image">
                    <div class="events__image-placeholder"></div>
                </div>
                <div class="events__content">
                    <div class="events__header">
                        <h3 class="events__name">{{ event.title }}</h3>
                    </div>
                    <div class="events__meta">
                        <div class="events__meta-item">
                            <svg class="events__meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <span class="events__date">{{ event.date_begin }}</span>
                        </div>
                        <div class="events__meta-item">
                            <svg class="events__meta-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                            </svg>
                            <span class="events__location">{{ event.place }}</span>
                        </div>
                    </div>
                    <p class="events__description">{{ event.info|slice:":100" }}...</p>
                    <div class="events__footer">
                        <div class="events__actions">
                            <a class="href btn btn-primary events__btn" href="{% url 'event_details' event.id %}">Подробнее</a>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}

        {% if page_obj.has_other_pages %}
            <div class="events__pagination">
                <!-- Кнопка "Назад" -->
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}" class="btn btn-outline events__pagination-btn href">Назад</a>
                {% else %}
                    <button class="btn btn-outline events__pagination-btn events__pagination-btn--disabled" disabled>Назад</button>
                {% endif %}

                <!-- Умная пагинация: максимум 3 кнопки -->
                {% with total_pages=page_obj.paginator.num_pages current_page=page_obj.number %}
                    {% if total_pages <= 3 %}
                        <!-- Если страниц <= 3, показываем все -->
                        {% for num in page_obj.paginator.page_range %}
                            {% if current_page == num %}
                                <button class="btn btn-outline events__pagination-btn events__pagination-btn--active">{{ num }}</button>
                            {% else %}
                                <a href="?page={{ num }}" class="btn btn-outline events__pagination-btn">{{ num }}</a>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        <!-- Если страниц > 3, показываем только 3 кнопки -->
                        {% if current_page == 1 %}
                            <!-- Первая страница: 1, 2, 3 -->
                            <button class="btn btn-outline events__pagination-btn events__pagination-btn--active">1</button>
                            <a href="?page=2" class="btn btn-outline events__pagination-btn href">2</a>
                            <a href="?page=3" class="btn btn-outline events__pagination-btn href">3</a>
                        {% elif current_page == total_pages %}
                            <!-- Последняя страница: предпоследняя, последняя -->
                            <a href="?page={{ total_pages|add:-2 }}" class="btn btn-outline events__pagination-btn href">{{ total_pages|add:-2 }}</a>
                            <a href="?page={{ total_pages|add:-1 }}" class="btn btn-outline events__pagination-btn href">{{ total_pages|add:-1 }}</a>
                            <button class="btn btn-outline events__pagination-btn events__pagination-btn--active">{{ total_pages }}</button>
                        {% elif current_page == 2 %}
                            <!-- Вторая страница: 1, 2, 3 -->
                            <a href="?page=1" class="btn btn-outline events__pagination-btn href">1</a>
                            <button class="btn btn-outline events__pagination-btn events__pagination-btn--active">2</button>
                            <a href="?page=3" class="btn btn-outline events__pagination-btn href">3</a>
                        {% elif current_page == total_pages|add:-1 %}
                            <!-- Предпоследняя страница -->
                            <a href="?page={{ total_pages|add:-2 }}" class="btn btn-outline events__pagination-btn href">{{ total_pages|add:-2 }}</a>
                            <button class="btn btn-outline events__pagination-btn events__pagination-btn--active">{{ total_pages|add:-1 }}</button>
                            <a href="?page={{ total_pages }}" class="btn btn-outline events__pagination-btn href">{{ total_pages }}</a>
                        {% else %}
                            <!-- Где-то в середине: предыдущая, текущая, следующая -->
                            <a href="?page={{ current_page|add:-1 }}" class="btn btn-outline events__pagination-btn href">{{ current_page|add:-1 }}</a>
                            <button class="btn btn-outline events__pagination-btn events__pagination-btn--active">{{ current_page }}</button>
                            <a href="?page={{ current_page|add:1 }}" class="btn btn-outline events__pagination-btn href">{{ current_page|add:1 }}</a>
                        {% endif %}
                    {% endif %}
                {% endwith %}

                <!-- Кнопка "Вперёд" -->
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}" class="btn btn-outline events__pagination-btn href">Вперёд</a>
                {% else %}
                    <button class="btn btn-outline events__pagination-btn events__pagination-btn--disabled href" disabled>Вперёд</button>
                {% endif %}
            </div>
        {% endif %}
    </div>
</div>
{% block extra_js %}
<script src=""></script>
{% endblock %}
{% endblock %}
